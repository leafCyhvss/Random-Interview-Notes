![[2023-6-1.jpg]]

视频平台需要编码解码，可以先上传到s3，再交给message queue，mq给编解码服务器处理（aws lambda). 为了增加读性能使用slave，为了增加稳定性使用replica

## 什么时候用消息队列
在系统设计面试中，当你遇到以下几种情况时，可能需要考虑使用消息队列（Message Queue）：

1. **异步处理**：当你需要将一些耗时的任务从主程序流中剥离出来，以提高系统的响应性能时，消息队列是一个很好的选择。例如，用户**上传了一张图片并请求进行处理**，这个处理可能需要较长时间，你可以将处理任务放入消息队列，让另一个后台服务进行处理。

2. **负载削峰**：当系统面临大流量或者突发的请求量增加，消息队列可以起到缓冲的作用，将请求暂时存储起来，然后按照处理服务的能力进行有序处理。

3. **解耦合**：当系统中的组件需要相互通信，但你又希望它们尽可能地独立开来，消息队列可以作为它们之间的中间层，让它们不直接相互依赖。

4. **可靠性**：如果你希望系统能够在失败后自动恢复，消息队列可以帮助你实现这一点。一旦处理服务发生故障，消息队列可以保留未处理的消息，等到服务恢复后继续处理。

5. **分布式系统通信**：在分布式系统中，不同的服务或者组件可能运行在不同的机器上，甚至在不同的地理位置。消息队列可以提供一个统一的接口，让这些服务和组件进行跨网络的通信。

需要注意的是，虽然消息队列有很多优点，但也有一些潜在的问题需要考虑，例如消息的重复，顺序，延迟，以及队列的维护等。所以在决定使用消息队列时，需要根据系统的具体需求和约束进行权衡。

数据库选择：
选择关系型数据库（SQL）还是非关系型数据库（NoSQL）通常取决于特定应用的数据需求和业务特性。以下是一些示例：

**使用关系型数据库的场景：**

1. **银行系统**：在银行或金融系统中，数据的一致性和事务性是至关重要的。例如，如果有两个人同时尝试访问同一个账户，关系型数据库能够保证在同一时间只有一个事务在进行，从而避免冲突和数据不一致。

2. **电子商务系统**：电子商务网站需要处理包括产品目录，用户信息，订单，购物车，支付等在内的复杂关系，这种情况下，关系型数据库可以提供强大的查询和事务处理能力。

**使用NoSQL数据库的场景：**

1. **社交媒体**：在社交媒体网站中，用户和他们的社交关系，喜好，动态等数据非常大量且不断增长，而且结构可能不固定。例如，一个用户可能加入了几个群组，发布了很多帖子，同时还有一些好友和粉丝。这种情况下，NoSQL数据库（如文档数据库或图数据库）能够提供更好的扩展性和灵活性。

2. **实时分析和大数据应用**：例如，一个在线广告系统可能需要根据用户行为和偏好实时分析和决定应该展示哪些广告。因为数据量大，更新频繁，关系可能不固定，所以NoSQL数据库（如列存储或键值存储）可以提供更好的性能和扩展性。

总的来说，如果你需要处理复杂的关系，保证数据的一致性，或者执行复杂的查询，关系型数据库可能是更好的选择。如果你需要处理大量，变化快，或者结构不固定的数据，或者你需要很好的水平扩展性，NoSQL数据库可能更合适。这并不是绝对的，实际的选择应根据具体的业务需求和技术环境来定。



## ACID的具体含义
原子性：要么所有的操作都成功提交，要么全部失败回滚，用户不会看到中间状态。
一致性：数据库在事务执行前后都保持一致性状态，在ACID中的一致性强调的是事务内部的数据一致性。
隔离性：多个事务同时进行时，一个事务的执行不应该影响其他事务的执行。
持久性：一旦事务提交，其所做的修改将永久保存在数据库中，即使系统发生故障也不会丢失。




银行系统是否会使用NoSQL系统？
银行和其他金融机构传统上依赖于具有强ACID属性的关系型数据库，以保证交易的安全和数据的精确性。然而，随着数据量的增长和业务需求的变化，一些银行开始探索NoSQL数据库，尤其是在以下场景中：

大数据分析：处理大量非结构化数据，如客户交互和交易日志。
缓存和会话存储：使用NoSQL数据库提高数据访问速度和改善用户体验。
灵活性和可扩展性需求：在需要快速扩展或处理大规模分布式数据时使用NoSQL。
因此，虽然核心交易系统可能仍然依赖于关系型数据库，但银行可能会在非核心应用中部署NoSQL解决方案以提高性能和灵活性。

